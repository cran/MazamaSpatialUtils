<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Mazama Science" />

<meta name="date" content="2015-02-10" />

<title>Introduction to MazamaSpatialUtils</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Introduction to MazamaSpatialUtils</h1>
<h4 class="author"><em>Mazama Science</em></h4>
<h4 class="date"><em>2015-02-10</em></h4>
</div>


<div id="background" class="section level2">
<h2>Background</h2>
<p>The MazamaSpatialUtils package was created by <a href="http://mazamascience.com">MazamaScience</a> to regularize our work with spatial data. The <strong>sp</strong>, <strong>rgdal</strong> and **maptools packages have made it much easier to work with spatial data found in shapefiles. Many sources of shapefile data are available and can be used to make beautfiul maps in R. Unfortunately, the data attached to these datasets, even when fairly complete, often lacks standardized identifiers such as the ISO 3166-1 alpha-2 encodings for countries. Maddeningly, even when these ISO codes are used, the dataframe column in which they are stored does not have a standardized name. It may be called <code>ISO</code> or <code>ISO2</code> or <code>alpha</code> or <code>COUNTRY</code> or any of a dozen other names we have seen.</p>
<p>While many mapping packages provide ‘natural’ naming of countries, those who wish to develop operational, GIS-like systems need something that is both standardized and language-independent. The ISO 3166-1 alpha-2 encodings have emerged as the <em>defacto</em> standard for this sort of work. In similar fashion, ISO 3166-2 alpha-2 encodings are aviailable for the next administrative level down – state/province/oblast, <em>etc.</em>. For timezones, the <em>defacto</em> standard is the set of Olson timezones used in all UNIX systems.</p>
<p>The main goal of this package is to create an internally standardized set of spatial data that we can use in various projects. Along with two built-in datasets, this package provides ‘convert~’ functions for other spatial datasets that we currently use. These convert functions all follow the same recipe:</p>
<ul>
<li>download spatial data in shapefile format into a standard directory</li>
<li>convert shapefile data into a <em>sp</em> SpatialPolygonsDataFrame</li>
<li>modify the dataframe in the <span class="citation">@data</span> slot so that it adheres to package internal standards</li>
</ul>
<p>Other datasets can be added following the same procedure.</p>
<p>The ‘package internal standards’ are very simple. Every spatial dataset will have at least one of the following, consistently named colums of data:</p>
<ul>
<li>countryCode – ISO 3166-1 alpha-2</li>
<li>stateCode – ISO 3166-2 alpha-2</li>
<li>timezone – Olson timezone</li>
</ul>
<p>If another column contains this data, that column must be renamed or duplicated with the internally standardized name. This simple level of consistency makes it posisble to generate maps for any data that is ISO encoded. It also makes it possible to create functions that return the country, state or timezone associated with a set of locations.</p>
</div>
<div id="functionality" class="section level2">
<h2>Functionality</h2>
<p>The core functionality for which this package was developed is determining spatial information associated with a set of locations.</p>
<p>Current functionality includes the following:</p>
<ul>
<li><code>getCountry~(lon,lat)</code> – returns names, ISO codes and other country-level data specified locations</li>
<li><code>getState~(lon,lat)</code> – returns names, ISO codes and other state-level at specified locations</li>
<li><code>getUSCounty~(lon,lat)</code> – returns names and other county-level data at specified locations</li>
<li><code>getTimezones(lon,lat)</code> – returns Olson timezones and other data at specified locations</li>
</ul>
<p>For those working with geo-located data, this information is key.</p>
</div>
<div id="standard-datasets-and-setup" class="section level2">
<h2>Standard Datasets and Setup</h2>
<p>When using MazamaSpatialUtils, always run <code>setSpatialDataDir('SOME_DIRECTORY')</code> first. This sets the directory where spatial data will be installed and loaded from.</p>
<p>MazamaSpatialUtils has 2 built-in datasets:</p>
<ul>
<li><code>SimpleCountries</code></li>
<li><code>SimpleTimezones</code></li>
</ul>
<p>Version 0.1 of the package is built around the two internal datasets and five other core datasets that may be installed:</p>
<ul>
<li><code>NaturalEarthAdm1</code></li>
<li><code>TMWorldBorders</code></li>
<li><code>TMWorldBordersSimple</code></li>
<li><code>USCensusCounties</code></li>
<li><code>WorldTimezones</code></li>
</ul>
<p>These datasets are not included in the package. You must instead run <code>initializeSpatialData()</code> which will download each dataset into your data directory as <code>.RData</code> files.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MazamaSpatialUtils)

<span class="co"># Set data directory to working directory</span>
<span class="kw">setSpatialDataDir</span>(<span class="st">'./SpatialData'</span>)
<span class="kw">initializeSpatialData</span>()</code></pre>
<p>You may also install datasets individually.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">convertNaturalEarthAdm1</span>()
<span class="kw">convertTMWorldBorders</span>()
<span class="kw">convertTMWorldBordersSimple</span>()
<span class="kw">convertUSCensusCounties</span>()
<span class="kw">convertWorldTimezones</span>()</code></pre>
</div>
<div id="loading-datasets" class="section level2">
<h2>Loading Datasets</h2>
<p>Running <code>initializeSpatialData()</code> will also load each dataset into the environment. If you installed a dataset individually or are coming back to a project, load a dataset with the <code>loadSpatialData(DATASET)</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">loadSpatialData</span>(<span class="st">'NaturalEarthAdm1'</span>)
<span class="kw">loadSpatialData</span>(<span class="st">'TMWorldBorders'</span>)
<span class="kw">loadSpatialData</span>(<span class="st">'TMWorldBordersSimple'</span>)
<span class="kw">loadSpatialData</span>(<span class="st">'USCensusCounties'</span>)
<span class="kw">loadSpatialData</span>(<span class="st">'WorldTimezones'</span>)</code></pre>
</div>
<div id="getcountry-and-getcountrycode" class="section level2">
<h2><code>getCountry()</code> and <code>getCountryCode()</code></h2>
<p>These two functions are used for finding which country one or many spatial points are in. <code>getCountry()</code> returns English country names and <code>getCountryCode()</code> returns the ISO-3166 two character country code. Both functions can be passed <code>allData = TRUE</code> which returns a dataframe with more information on the countries. You can also specify <code>countryCodes = c(CODES)</code> to speed up searching.</p>
<p>These functions use the package-internal <code>SimpleCountries</code> dataset which can be used without loading any additional datasets.</p>
<p>In this example we’ll find which countries a vector of points fall in.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(MazamaSpatialUtils)

lon &lt;-<span class="st"> </span><span class="kw">c</span>(-<span class="fl">122.3</span>, -<span class="fl">73.5</span>, <span class="fl">21.1</span>, <span class="fl">2.5</span>)
lat &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">47.5</span>, <span class="fl">40.75</span>, <span class="fl">52.1</span>, <span class="fl">48.5</span>)

<span class="kw">getCountry</span>(lon, lat)</code></pre>
<pre><code>## [1] &quot;United States&quot; &quot;United States&quot; &quot;Poland&quot;        &quot;France&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCountryCode</span>(lon, lat)</code></pre>
<pre><code>## [1] &quot;US&quot; &quot;US&quot; &quot;PL&quot; &quot;FR&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getCountry</span>(lon, lat, <span class="dt">allData=</span><span class="ot">TRUE</span>)</code></pre>
<pre><code>##   FIPS ISO3  UN countryCode   countryName longitude latitude
## 1   US  USA 840          US United States   -98.606   39.622
## 2   US  USA 840          US United States   -98.606   39.622
## 3   PL  POL 616          PL        Poland    19.401   52.125
## 4   FR  FRA 250          FR        France     2.550   46.565</code></pre>
</div>
<div id="getstate-and-getstatecode" class="section level2">
<h2><code>getState()</code> and <code>getStateCode()</code></h2>
<p>Similar to above, these functions return state names and ISO 3166 code. They also take the same arguments. Adding the <code>countryCodes</code> argument is more important for <code>getState()</code> and <code>getStateCode()</code> because the <code>NaturalEarthAdm1</code> dataset is fairly large. Lets use the same <code>lat</code> and <code>lon</code> variables as above and find out which states those points are in.</p>
<p>These functions require installation of the large <code>NaturalEarthAdm1</code> dataset which is not distributed with the package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load states dataset if you haven't already</span>
<span class="kw">loadSpatialData</span>(<span class="st">&quot;NaturalEarthAdm1&quot;</span>)

<span class="co"># Get which countries the points are in</span>
countryCodes &lt;-<span class="st"> </span><span class="kw">getCountryCode</span>(lon, lat)

<span class="co"># Pass the country codes as an argument to speed everything up</span>
<span class="kw">getState</span>(lon, lat, <span class="dt">countryCodes =</span> countryCodes)

<span class="kw">getStateCode</span>(lon, lat, <span class="dt">countryCodes =</span> countryCodes)

<span class="co"># This is a very detailed dataset so we'll grab a few important columns</span>
states &lt;-<span class="st"> </span><span class="kw">getState</span>(lon, lat, <span class="dt">allData=</span><span class="ot">TRUE</span>, <span class="dt">countryCodes =</span> countryCodes)
states[<span class="kw">c</span>(<span class="st">'countryCode'</span>, <span class="st">'stateCode'</span>, <span class="st">'stateName'</span>)]</code></pre>
</div>
<div id="gettimezone" class="section level2">
<h2><code>getTimezone()</code></h2>
<p>Returns the Olsen Timezone where the given points are located. Arguments are the same as the previous functions. <code>allData=TRUE</code> will return other useful information such as the UTC Offset.</p>
<p>These functions use the package-internal <code>SimpleTimezones</code> dataset which can be used without loading any additional datasets.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the timezones the points are in</span>
<span class="kw">getTimezone</span>(lon, lat)</code></pre>
<pre><code>## [1] &quot;America/Los_Angeles&quot; &quot;America/New_York&quot;    &quot;Europe/Warsaw&quot;      
## [4] &quot;Europe/Paris&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find which countries the points are in</span>
countryCodes &lt;-<span class="st"> </span><span class="kw">getCountryCode</span>(lon, lat)

<span class="co"># Pass the country codes as an argument to potentially speed things up</span>
<span class="kw">getTimezone</span>(lon, lat, <span class="dt">countryCodes =</span> countryCodes)</code></pre>
<pre><code>## [1] &quot;America/Los_Angeles&quot; &quot;America/New_York&quot;    &quot;Europe/Warsaw&quot;      
## [4] &quot;Europe/Paris&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getTimezone</span>(lon, lat, <span class="dt">allData=</span><span class="ot">TRUE</span>, <span class="dt">countryCodes =</span> countryCodes)</code></pre>
<pre><code>##              timezone UTC_offset UTC_DST_offset countryCode   longitude
## 1 America/Los_Angeles         -8             -7          US -118.242778
## 2    America/New_York         -5             -4          US  -74.006389
## 3       Europe/Warsaw          1              2          PL   21.000000
## 4        Europe/Paris          1              2          FR    2.333333
##   latitude
## 1 34.05083
## 2 40.71167
## 3 52.25417
## 4 48.88111</code></pre>
</div>
<div id="getuscounty" class="section level2">
<h2><code>getUSCounty()</code></h2>
<p>Returns the US Country which name pairs of coordinates fall in. The arguments are similar as above except that <code>stateCodes=c()</code> is used instead of <code>countryCodes=c()</code> since this dataset is US specific.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load counties dataset if you haven't already</span>
<span class="kw">loadSpatialData</span>(<span class="st">&quot;USCensusCounties&quot;</span>)

<span class="co"># New dataset of points only in the US</span>
stateCodes &lt;-<span class="st"> </span><span class="kw">getStateCode</span>(lon,lat)

<span class="co"># Optionally pass the state codes as an argument to speed everything up</span>
<span class="kw">getUSCounty</span>(lon, lat, <span class="dt">stateCodes=</span>stateCodes)

<span class="kw">getUSCounty</span>(lon, lat, <span class="dt">allData=</span><span class="ot">TRUE</span>, <span class="dt">stateCodes=</span>stateCodes)</code></pre>
</div>
<div id="timezone-map" class="section level2">
<h2>Timezone Map</h2>
<p>While identifying the states, countries and timezones associatated with a set of locations is important, we can also generate some quick eye candy with these datasets. Let’s color the timezones by the data variable ‘UTC_offset’</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)         <span class="co"># For spatial plotting</span>

<span class="co"># Assign timezones polygons an index based on UTC_offset</span>
colorIndices &lt;-<span class="st"> </span><span class="kw">.bincode</span>(SimpleTimezones@data$UTC_offset, <span class="dt">breaks=</span><span class="kw">seq</span>(-<span class="fl">12.5</span>,<span class="fl">12.5</span>,<span class="dv">1</span>))

<span class="co"># Color our timezones by UTC_offset</span>
<span class="kw">plot</span>(SimpleTimezones, <span class="dt">col=</span><span class="kw">rainbow</span>(<span class="dv">25</span>)[colorIndices])
<span class="kw">title</span>(<span class="dt">line=</span>-<span class="dv">3</span>,<span class="st">'Timezone Offsets from UTC'</span>)</code></pre>
</div>
<div id="working-with-iso-3166-1-encoded-data" class="section level2">
<h2>Working with ISO 3166-1 Encoded Data</h2>
<p>On of the main reasons for ensuring that our spatial datasets use ISO encoding is that it makes it easy to generate plots with any datasets that use that encoding. Here is a slightly more involved example using Energy data from the British Petroleum Statistical Review that has been ISO-encoded.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)         <span class="co"># For spatial plotting</span>
<span class="kw">library</span>(stringr)    <span class="co"># For string processing</span>

<span class="co"># Read in ISO-encoded oil production and consumption data</span>
prod &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">url</span>(<span class="st">'http://mazamascience.com/OilExport/BP_2014_oil_production_bbl.csv'</span>),
                 <span class="dt">skip=</span><span class="dv">6</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>, <span class="dt">na.strings=</span><span class="st">'na'</span>)
cons &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">url</span>(<span class="st">'http://mazamascience.com/OilExport/BP_2014_oil_consumption_bbl.csv'</span>),
                 <span class="dt">skip=</span><span class="dv">6</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>, <span class="dt">na.strings=</span><span class="st">'na'</span>)

<span class="co"># Only work with ISO-encoded columns of data</span>
prodCountryCodes &lt;-<span class="st"> </span><span class="kw">names</span>(prod)[ <span class="kw">str_length</span>(<span class="kw">names</span>(prod)) ==<span class="st"> </span><span class="dv">2</span> ]
consCountryCodes &lt;-<span class="st"> </span><span class="kw">names</span>(cons)[ <span class="kw">str_length</span>(<span class="kw">names</span>(cons)) ==<span class="st"> </span><span class="dv">2</span> ]

<span class="co"># Use the last row (most recent data)</span>
lastRow &lt;-<span class="st"> </span><span class="kw">nrow</span>(prod)
year &lt;-<span class="st"> </span>prod$YEAR[lastRow]

<span class="co"># Neither dataframe contains all countries so create four categories based on the</span>
<span class="co"># amount of information we have:  netExporters, netImporters, exportOnly, importOnly</span>
sharedCountryCodes &lt;-<span class="st"> </span><span class="kw">intersect</span>(prodCountryCodes,consCountryCodes)
net &lt;-<span class="st"> </span>prod[lastRow, sharedCountryCodes] -<span class="st"> </span>cons[lastRow, sharedCountryCodes]

<span class="co"># Find codes associated with each category</span>
netExportCodes &lt;-<span class="st"> </span>sharedCountryCodes[net &gt;<span class="st"> </span><span class="dv">0</span>]
netImportCodes &lt;-<span class="st"> </span>sharedCountryCodes[net &lt;=<span class="st"> </span><span class="dv">0</span>]
exportOnlyCodes &lt;-<span class="st"> </span><span class="kw">setdiff</span>(prodCountryCodes,consCountryCodes)
importOnlyCodes &lt;-<span class="st"> </span><span class="kw">setdiff</span>(consCountryCodes,prodCountryCodes)

<span class="co"># Create a logical 'mask' associated with each category</span>
netExportMask &lt;-<span class="st"> </span>SimpleCountries@data$countryCode %in%<span class="st"> </span>netExportCodes
netImportMask &lt;-<span class="st"> </span>SimpleCountries@data$countryCode %in%<span class="st"> </span>netImportCodes
onlyExportMask &lt;-<span class="st"> </span>SimpleCountries@data$countryCode %in%<span class="st"> </span>exportOnlyCodes
onlyImportMask &lt;-<span class="st"> </span>SimpleCountries@data$countryCode %in%<span class="st"> </span>importOnlyCodes

color_export =<span class="st"> '#40CC90'</span>
color_import =<span class="st"> '#EE5555'</span>
color_missing =<span class="st"> 'gray90'</span>

<span class="co"># Base plot (without Antarctica)</span>
notAQ &lt;-<span class="st"> </span>SimpleCountries@data$countryCode !=<span class="st"> 'AQ'</span>
<span class="kw">plot</span>(SimpleCountries[notAQ,],<span class="dt">col=</span>color_missing)

<span class="kw">plot</span>(SimpleCountries[netExportMask,],<span class="dt">col=</span>color_export,<span class="dt">add=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(SimpleCountries[onlyExportMask,],<span class="dt">col=</span>color_export,<span class="dt">add=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(SimpleCountries[netImportMask,],<span class="dt">col=</span>color_import,<span class="dt">add=</span><span class="ot">TRUE</span>)
<span class="kw">plot</span>(SimpleCountries[onlyImportMask,],<span class="dt">col=</span>color_import,<span class="dt">add=</span><span class="ot">TRUE</span>)

<span class="kw">legend</span>(<span class="st">'bottomleft'</span>,<span class="dt">legend=</span><span class="kw">c</span>(<span class="st">'Net Exporters'</span>,<span class="st">'Net Importers'</span>),<span class="dt">fill=</span><span class="kw">c</span>(color_export,color_import))
<span class="kw">title</span>(<span class="dt">line=</span><span class="dv">0</span>,<span class="kw">paste</span>(<span class="st">'World Crude Oil in'</span>,year))</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
